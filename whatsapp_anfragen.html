    <title>Pakora WhatsApp Anfragen</title>
    <link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-messaging-compat.js"></script>
    <style>
        :root {
            --bg: #e9edf1;
            --surface: #f0f2f5;
            --panel: #ffffff;
            --text: #111b21;
            --muted: #667781;
            --accent: #008069;
            --border: #d1d7db;
            --shadow: 0 10px 26px rgba(11, 20, 26, 0.12);
        }
        body {
            font-family: 'Sora', sans-serif;
            margin: 0;
            display: flex;
            height: 100vh;
            color: var(--text);
            overflow: hidden;
            background: linear-gradient(180deg, #f7f8f8, #e9edf1 45%, #f7f8f8);
        }
        .main {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        .header-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        .header-title h1 { margin: 0; font-size: 24px; font-weight: 700; }
        .header-title p { margin: 6px 0 0 0; color: var(--muted); font-size: 13px; }
        
        .back-link { display:inline-flex; align-items:center; gap:6px; font-size:12px; text-decoration:none; color:#0b4b2f; border:1px solid var(--border); padding:6px 10px; border-radius:999px; background:#fff; }
.request-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 16px;
        }
        .request-card {
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 16px;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .request-card strong { font-size: 14px; color: #0b4b2f; }
        .request-card p { margin: 0; font-size: 14px; color: #111b21; }
        .request-card span { font-size: 12px; color: var(--muted); }
        .request-card .actions { align-self: flex-end; display: flex; gap: 8px; margin-top: 8px; }
        .admin-btn {
            border: 1px solid var(--border);
            background: #f7f8f8;
            color: #1f2a33;
            font-size: 11px;
            padding: 4px 10px;
            border-radius: 999px;
            cursor: pointer;
        }
        .admin-btn.done { background: #d1f4cc; border-color: rgba(0,128,105,.35); color:#0b3220; }
        .empty-state { text-align: center; color: var(--muted); font-size: 14px; margin-top: 40px; }
    </style>
</head>
<body>
    <nav class="sidebar">
        <div class="logo"><img src="logo.png" alt="Pakora"></div>
        <a href="index.html" class="nav-item" data-section="dashboard"><span class="nav-icon">🏠</span><span class="nav-text">Uebersicht</span></a>
        <a href="index.html#calc" class="nav-item" data-section="calc"><span class="nav-icon">📐</span><span class="nav-text">Smart-Kalkulation</span></a>
        <a href="konfigurator.html" class="nav-item"><span class="nav-icon">🧊</span><span class="nav-text">Kuehlzellen Kalkulator</span></a>
        <a href="whatsapp_bot.html" class="nav-item only-mpak"><span class="nav-icon">🤖</span><span class="nav-text">WhatsApp Bot</span></a>
        <a href="whatsapp_anfragen.html" class="nav-item"><span class="nav-icon">💬</span><span class="nav-text">WhatsApp Anfragen</span></a>
        <a href="kommunikation.html" class="nav-item"><span class="nav-icon">📨</span><span class="nav-text">Kommunikation</span></a>
        <a href="verdichterrechereche.html" class="nav-item"><span class="nav-icon">🔍</span><span class="nav-text">Verdichter Recherche</span></a>
        <a href="index.html#db" class="nav-item" data-section="db"><span class="nav-icon">🗃</span><span class="nav-text">Produkt-Datenbank</span></a>
        <a href="lager_online.html" class="nav-item"><span class="nav-icon">📦</span><span class="nav-text">Lagerbestand</span></a>
        <a href="kalender.html?v=2" class="nav-item"><span class="nav-icon">📅</span><span class="nav-text">Kalender</span></a>
        <button id="logoutBtn" class="nav-item logout-btn" hidden>Logout</button>
    </nav>
    <div class="mobile-overlay" onclick="toggleSidebar()"></div>
    <button class="mobile-toggle" onclick="toggleSidebar()">☰</button>

    <main class="main">
        <div class="header-section">
            <a class="back-link" href="index.html">Zurueck zur Uebersicht</a>
<div class="header-title">
                <h1>WhatsApp Anfragen</h1>
                <p>Eingehende Kundenanfragen via WhatsApp</p>
            </div>
            <a href="kommunikation.html" style="text-decoration: none; color: var(--accent); font-weight: 600;">Zum Team-Chat</a>
        </div>
        <section class="request-list" id="requestList">
            <div class="empty-state">Lade Anfragen...</div>
        </section>
    </main>

    <script>
        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const overlay = document.querySelector('.mobile-overlay');
            if (!sidebar || !overlay) return;
            sidebar.classList.toggle('open');
            overlay.classList.toggle('active');
        }

        const firebaseConfig = {
            apiKey: "AIzaSyCjIggzBA4NaMNm1FSfTUzvZLBquvd9P40",
            authDomain: "pakora-automations-chat.firebaseapp.com",
            projectId: "pakora-automations-chat",
            storageBucket: "pakora-automations-chat.firebasestorage.app",
            messagingSenderId: "281325034328",
            appId: "1:281325034328:web:e05c04bac6b8558560632d"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const ADMIN_USER = 'm.pak';
        const AUTH_KEY = 'pakora_auth_user';
        const LEGACY_AUTH_KEY = 'pakora_chat_user';
        const getStoredUser = () =>
            (localStorage.getItem(AUTH_KEY) || localStorage.getItem(LEGACY_AUTH_KEY) || '').toLowerCase();
        const isAdmin = () => getStoredUser() === ADMIN_USER;
        const ACCOUNTS = {
            'm.pak': { label: 'Mert Kaan' },
            'k.guemuesok': { label: 'Kaan' },
            'l.wenzel': { label: 'Leon' },
            'oe.pak': { label: 'Oemer' }
        };
        const accountLabel = (id) => (ACCOUNTS[id] && ACCOUNTS[id].label) ? ACCOUNTS[id].label : (id || '-');

        function formatTime(ts) {
            if (!ts) return '--:--';
            const date = ts.toDate ? ts.toDate() : new Date(ts);
            return date.toLocaleString('de-DE', { day: '2-digit', month: '2-digit', hour: '2-digit', minute: '2-digit' });
        }

        function renderRequests(requests) {
            const listEl = document.getElementById('requestList');
            if (!listEl) return;
            listEl.innerHTML = '';
            if (!requests.length) {
                listEl.innerHTML = '<div class="empty-state">Keine WhatsApp-Anfragen vorhanden.</div>';
                return;
            }

            requests.forEach((req) => {
                const card = document.createElement('div');
                card.className = 'request-card';
                const author = document.createElement('strong');
                author.textContent = `${req.name || 'Unbekannt'} (${req.phone || '-'})`;
                const text = document.createElement('p');
                text.textContent = req.message || '';
                const meta = document.createElement('span');
                let status = req.status === 'done' ? 'Erledigt' : 'Offen';
                if (req.autoReplied) status = 'Bot Antwort';
                if (req.status === 'done') {
                    const doneByLabel = req.doneBy ? accountLabel(req.doneBy) : '';
                    status = doneByLabel ? `Erledigt (${doneByLabel})` : 'Erledigt';
                }
                meta.textContent = `${status} | ${formatTime(req.createdAt)}`;
                
                const actions = document.createElement('div');
                actions.className = 'actions';

                const copyBtn = document.createElement('button');
                copyBtn.className = 'admin-btn';
                copyBtn.textContent = 'Inhalt kopieren';
                copyBtn.onclick = () => {
                    const payload = `${req.name || ''} ${req.phone || ''} - ${req.message || ''}`.trim();
                    navigator.clipboard.writeText(payload).then(() => alert('Kopiert!'));
                };
                
                actions.appendChild(copyBtn);

                if (isAdmin()) {
                    const doneBtn = document.createElement('button');
                    doneBtn.className = `admin-btn ${req.status === 'done' ? 'done' : ''}`;
                    doneBtn.textContent = 'Erledigt';
                    doneBtn.onclick = () => {
                        if (!isAdmin()) { alert('Nur m.pak darf loeschen.'); return; }
                        const userId = getStoredUser();
                        db.collection('whatsappRequests').doc(req.id).set({
                            status: 'done',
                            doneBy: userId,
                            doneAt: firebase.firestore.FieldValue.serverTimestamp(),
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        }, { merge: true });
                    };
                    actions.appendChild(doneBtn);

                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'admin-btn';
                    deleteBtn.textContent = 'Loeschen';
                    deleteBtn.onclick = () => {
                        if (!isAdmin()) { alert('Nur m.pak darf loeschen.'); return; }
                        if (!confirm('Anfrage wirklich loeschen?')) return;
                        db.collection('whatsappRequests').doc(req.id).delete();
                    };
                    actions.appendChild(deleteBtn);
                }
                card.appendChild(author);
                card.appendChild(text);
                card.appendChild(meta);
                card.appendChild(actions);
                listEl.appendChild(card);
            });
        }

        function listenWhatsappRequests() {
            db.collection('whatsappRequests')
                .orderBy('createdAt', 'desc')
                .limit(100)
                .onSnapshot((snapshot) => {
                    const requests = [];
                    snapshot.forEach((doc) => {
                        requests.push({ id: doc.id, ...doc.data() });
                    });
                    renderRequests(requests);
                }, (error) => {
                    console.error('Fehler beim Laden der WhatsApp-Anfragen:', error);
                    const listEl = document.getElementById('requestList');
                    if(listEl) listEl.innerHTML = '<div class="empty-state">Fehler beim Laden.</div>';
                });
        }

        listenWhatsappRequests();
    </script>
    <script>
        (function () {
            const path = (window.location.pathname.split('/').pop() || 'index.html');
            const links = document.querySelectorAll('.sidebar .nav-item[href]');
            let activeSet = false;
            links.forEach((link) => {
                const href = link.getAttribute('href') || '';
                const cleanHref = href.split('#')[0].split('?')[0];
                if (cleanHref && cleanHref === path) {
                    link.classList.add('active');
                    activeSet = true;
                }
            });

            if (path === 'index.html') {
                const hash = (window.location.hash || '').replace('#', '');
                if (hash && typeof nav === 'function') {
                    nav(hash);
                    const targetLink = document.querySelector(`.sidebar .nav-item[data-section="${hash}"]`);
                    if (targetLink) {
                        links.forEach((link) => link.classList.remove('active'));
                        targetLink.classList.add('active');
                        activeSet = true;
                    }
                }
            }

            if (!activeSet) {
                const defaultLink = document.querySelector('.sidebar .nav-item[data-section="dashboard"]');
                if (defaultLink) defaultLink.classList.add('active');
            }
        })();
    </script>

<style>
/* SIDEBAR UNIFY */
.sidebar {
    background: #0f172a;
    color: #ffffff;
}
.sidebar a,
.sidebar a:visited,
.sidebar a:active,
.sidebar a:hover,
.sidebar .nav-item,
.sidebar .nav-item:visited,
.sidebar .nav-item:active,
.sidebar .nav-item:hover {
    text-decoration: none !important;
}
.sidebar a * {
    text-decoration: none !important;
}
.sidebar .nav-item {
    color: #94a3b8;
    padding: 14px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    gap: 15px;
    font-weight: 500;
}
.sidebar .nav-item:hover {
    background: rgba(255,255,255,0.1);
    color: #ffffff;
}
.sidebar .nav-item.active {
    background: var(--primary, #2563eb);
    color: #ffffff;
    box-shadow: 0 4px 15px rgba(37,99,235,0.4);
}
</style>

<style>
/* WHATSAPP MOBILE */
.logo { margin-bottom: 60px; }
.logo img { max-width: 100%; height: auto; max-height: 150px; object-fit: contain; }
.nav-item .nav-icon { width: 22px; display: inline-flex; justify-content: center; font-size: 16px; line-height: 1; }
.nav-item .nav-text { flex: 1; }
.mobile-toggle { display: none; position: fixed; top: 15px; right: 15px; z-index: 2000; background: #2563eb; color: #fff; border: none; padding: 10px 14px; border-radius: 50%; box-shadow: 0 4px 12px rgba(37,99,235,0.4); font-size: 20px; cursor: pointer; }
.mobile-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 900; }
@media (max-width: 900px) {
    .sidebar { position: fixed; height: 100%; transform: translateX(-100%); width: 85%; max-width: 320px; box-shadow: 10px 0 30px rgba(0,0,0,0.2); }
    .sidebar.open { transform: translateX(0); }
    .mobile-toggle { display: flex; align-items: center; justify-content: center; }
    .mobile-overlay.active { display: block; }
    .main { padding: 16px; }
    .header-section { flex-direction: column; align-items: flex-start; gap: 10px; }
    .request-list { grid-template-columns: 1fr; }
    .request-card .actions { width: 100%; justify-content: flex-start; flex-wrap: wrap; }
}
</style>
</body>
</html>


